var OCRUISE=function(e){e.currentDate=function(){var a=new Date;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()};e.init=function(){$(document).ready(function(){window.applicationCache&&window.applicationCache.addEventListener("updateready",function(a){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of OpenCruise is available. Load it now?")&&window.location.reload()},!1);window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||
window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition;if(window.openDatabase||window.indexedDB){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){},function(a){},{timeout:5E4,maximumAge:0,enableHighAccuracy:!0});e.defaultValues=
new e.config;localStorage.defaults?e.defaultValues.load():e.defaultValues.save();var a=e.defaultValues,c=function(){e.activeList=new e.cruiseList(a.pages.cruisePage);e.activeList.getCruises();ko.applyBindings(e.activeList,$("#cruiseListPage")[0]);ko.applyBindings(e.activeList,$("#cruisePage")[0]);ko.applyBindings(e.activeList,$("#emailPage")[0]);ko.applyBindings(e.activeList,$("#fieldsPage")[0]);ko.applyBindings(e.activeList,$("#plotPage")[0]);ko.applyBindings(e.activeList,$("#multiProductPage")[0]);
ko.applyBindings(e.defaultValues,$("#configPage")[0])};e.DB=window.openDatabase?new e.webSQL(e.webSQLConfig(),c):new e.indexedDB(e.indexedDBConfig(),c);$(".OCLoading").hide();$.mobile.initializePage();$.mobile.pageContainer.pagecontainer("change",a.pages.cruiseListPage,{});$("#cruisePage").bind("pagebeforeshow",function(){$("#selectPlotPopup ul").listview().listview("refresh");$("#cruiseName").trigger("change");$("#cruisePage").trigger("create")});$("#selectPlotPopup").on("click","li a",function(){e.activeList.selectedCruise().editPlot($(this).data("plotnum"))});
$("#plotPage").bind("pagebeforeshow",function(){$("#plotPage").trigger("create")});$("#fieldsPage").bind("pagebeforeshow",function(){$("#fieldsPage").trigger("create")});$("#multiProductPage").bind("pagebeforeshow",function(){$("#multiProductPage").trigger("create")});$("#emailPage").bind("pagebeforeshow",function(){e.activeList.selectedCruise().exportToCSV();$("#emailPage").trigger("create")})}else alert("Local Databases are not supported by your browser.")})};return e}(OCRUISE||{});OCRUISE=function(e){e.webSQL=function(a,c){this.name=a.name;this.version=a.version;this.tableNames=a.tables;this.initDatabase(a,c)};e.webSQL.prototype={insert:function(a,c,b){for(var d=this,g=[],f=0;f<a.length;f++){g[f]="INSERT INTO "+a[f][0]+" (";for(var e="",l="",k=0;k<a[f][1].length;k++)e=e+a[f][1][k]+", ",l+="?, ";g[f]=g[f]+e.substring(0,e.length-2)+") VALUES("+l.substring(0,l.length-2)+")"}this.DB.transaction(function(b){for(f=0;f<g.length;f++)b.executeSql(g[f],a[f][2],c,function(a,b){d.errorHandler(a,
b)})},function(a,b){d.errorHandler(a,b)},b)},select:function(a,c,b,d,g,f){var e=this,l=c;g&&(l="MAX("+c+") AS "+g);var k="SELECT "+l+" FROM "+a;if(f){var k=k+" WHERE ",m;for(m in f)k+=m+"="+f[m]+" AND ";k=k.substring(0,k.length-5)}""!=b&&(k+=" ORDER BY "+b);k+=";";this.DB.transaction(function(a){a.executeSql(k,[],d,function(a,b){e.errorHandler(a,b)})})},update:function(a,c,b){var d=this,g=[],f="UPDATE "+a+" SET",e;for(e in c)f+=" "+e+"=?,",g.push(c[e]);f=f.substring(0,f.length-1);if(b){f+=" WHERE ";
for(e in b)f+=e+"="+b[e]+" AND ";f=f.substring(0,f.length-5)}f+=";";this.DB.transaction(function(a){a.executeSql(f,g,d.nullDataHandler(),function(a,b){d.errorHandler(a,b)})})},deleteRows:function(a,c){for(var b=this,d=[],g=null,f=0;f<a.length;f++){d[f]="DELETE FROM "+a[f][0];d[f]+=" WHERE ";var g=a[f][1],e;for(e in g)d[f]+=e+"="+g[e]+" AND ";d[f]=d[f].substring(0,d[f].length-5)+";"}this.DB.transaction(function(a){for(f=0;f<d.length;f++)a.executeSql(d[f],[],c,function(a,d){b.errorHandler(a,d)})})},
initDatabase:function(a,c){(this.DB=openDatabase(a.name,"",a.descript,a.maxsize))?this.checkVersion(a,c):alert("Cannot open database, try installing and using a different web browser such as Chrome or Firefox.")},checkVersion:function(a,c){var b=this;""==this.DB.version?this.DB.changeVersion("",b.version,this.createTables(a,c),function(a,c){b.errorHandler(a,c)},function(){console.log("Database initialized to version: "+b.version)}):"1.0"==this.DB.version?this.DB.changeVersion("1.0","5.0",function(a){a.executeSql("ALTER TABLE cruise ADD COLUMN mpm INTEGER ");
a.executeSql('ALTER TABLE cruise ADD COLUMN field2name TEXT DEFAULT "DBH" ');a.executeSql('ALTER TABLE cruise ADD COLUMN field3name TEXT DEFAULT "Saw" ');a.executeSql('ALTER TABLE cruise ADD COLUMN field4name TEXT DEFAULT "Pulp" ');a.executeSql("ALTER TABLE cruise ADD COLUMN field2min TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field2max TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field2init TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field3min TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field3max TEXT ");
a.executeSql("ALTER TABLE cruise ADD COLUMN field3init TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field3field2min TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field4min TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field4max TEXT ");a.executeSql("ALTER TABLE cruise ADD COLUMN field4init TEXT ");a.executeSql("ALTER TABLE trees ADD COLUMN seg0prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg0len INTEGER");a.executeSql("ALTER TABLE trees ADD COLUMN seg1prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg1len INTEGER");
a.executeSql("ALTER TABLE trees ADD COLUMN seg2prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg2len INTEGER");a.executeSql("ALTER TABLE trees ADD COLUMN seg3prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg3len INTEGER");a.executeSql("ALTER TABLE trees ADD COLUMN seg4prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg4len INTEGER");a.executeSql("ALTER TABLE trees ADD COLUMN seg5prod TEXT");a.executeSql("ALTER TABLE trees ADD COLUMN seg5len INTEGER")},function(a,c){b.errorHandler(a,
c)},function(){console.log("Database upgraded from version 1.0 to version: 5.0");c()}):(this.createTables(a,c),console.log("Database Opened, Version: "+this.DB.version))},createTables:function(a,c){var b=this,d="";this.DB.transaction(function(c){for(var f in a.tables){d="";d+="CREATE TABLE IF NOT EXISTS "+a.tables[f].tableName+"(";for(var e in a.tables[f].fields)d+=a.tables[f].fields[e].name+" "+a.tables[f].fields[e].type+", ";d=d.substring(0,d.length-2)+");";c.executeSql(d,[],function(){b.nullDataHandler()},
function(a,c){b.errorHandler(a,c)});a.tables[f].index&&(d="CREATE INDEX IF NOT EXISTS "+a.tables[f].index.name+" ON "+a.tables[f].tableName+" ("+a.tables[f].index.fields+");",c.executeSql(d,[],function(){b.nullDataHandler()},function(a,c){b.errorHandler(a,c)}))}},function(a,c){b.errorHandler(a,c)},c)},deleteDatabase:function(){var a=this,c=[];if(confirm("All data will be erased, are you sure?")){for(var b=0;b<this.tableNames.length;b++)c[b]="DROP TABLE IF EXISTS "+this.tableNames[b].tableName+";";
this.DB.transaction(function(b){for(var g=0;g<c.length;g++)b.executeSql(c[g],[],a.nullDataHandler(),function(b,c){a.errorHandler(b,c)})},function(b,c){a.errorHandler(b,c)},function(){window.location.reload(!1)})}},nullDataHandler:function(){console.log("SQL Query Succeeded!!!")},errorHandler:function(a,c){var b="",d="";c?(b=c.message,d=c.code):a&&(b=a.message,d=a.code);console.log("Database Error: "+b+" (Code "+d+")");alert("Database Error:  "+b+" (Code "+d+") - make sure private browsing is OFF.");
return!1}};e.indexedDB=function(a,c){this.name=a.name;this.version=a.version;this.initDatabase(a,c)};e.indexedDB.prototype={insert:function(a,c,b){for(var d=[],g={},f=0;f<a.length;f++)d[f]=a[f][0];var e=this.DB.transaction(this.DB.objectStoreNames,"readwrite");e.oncomplete=function(a){b()};for(f=0;f<a.length;f++){for(var l=e.objectStore(d[f]),k=0;k<a[f][1].length;k++)g[a[f][1][k]]=a[f][2][k];l=l.add(g);g={};l.onerror=function(a){alert("IndexedDB Error.")};l.onsuccess=function(a){c(null,{insertId:a.target.result})}}},
select:function(a,c,b,d,g,f){b="next";g&&(b="prev");var e={rows:{length:0,contents:[],item:function(a){return this.contents[a]}}};a=this.DB.transaction(a,"readonly").objectStore(a);var l={indexName:a.indexNames[0],indexRange:null};f&&(l=this.buildKeyRange(f));a.index(l.indexName).openCursor(l.indexRange,b).onsuccess=function(a){if(a=a.target.result)if(e.rows.length++,e.rows.contents.push(a.value),g)e.rows.contents[0][g]=a.value[c],d("",e);else a["continue"]();else g&&(e.rows.contents[0]={},e.rows.contents[0][g]=
0,e.rows.length=1),d("",e)}},update:function(a,c,b){for(var d in b)c[d]=b[d];this.DB.transaction(a,"readwrite").objectStore(a).put(c).onerror=function(a){alert("IndexedDB Error - error updating cruise parameters.")}},deleteRows:function(a,c){for(var b=[],d={},e=0;e<a.length;e++)b[e]=a[e][0];var f=this.DB.transaction(b,"readwrite");f.oncomplete=function(a){c()};for(e=0;e<a.length;e++){var h=f.objectStore(b[e]),d=this.buildKeyRange(a[e][1]);h.index(d.indexName).openCursor(d.indexRange).onsuccess=function(a){if(a=
a.target.result)a["delete"](),a["continue"]()}}},initDatabase:function(a,c){var b=this,d=indexedDB.open(a.name,a.version);d.onerror=function(a){alert("IndexedDB Error - could not open database.")};d.onsuccess=function(a){b.DB=a.target.result;c();b.DB.onerror=function(a){b.errorHandler(a)}};d.onupgradeneeded=function(c){b.createTables(c,a)}},createTables:function(a,c){this.DB=a.target.result;for(var b=0;b<c.stores.length;b++)for(var d=this.DB.createObjectStore(c.stores[b].storeName,{keyPath:c.stores[b].keyPath,
autoIncrement:c.stores[b].autoIncrement}),e=0;e<c.stores[b].indexes.length;e++)d.createIndex(c.stores[b].indexes[e].name,c.stores[b].indexes[e].fields,{unique:c.stores[b].indexes[e].unique})},deleteDatabase:function(){confirm("All data will be erased, are you sure?")&&(window.indexedDB.deleteDatabase(this.name),window.location.reload(!1))},buildKeyRange:function(a){var c=[],b={indexName:"",indexRange:null},d;for(d in a)b.indexName+=d,c.push(parseInt(a[d]));b.indexRange=1==c.length?IDBKeyRange.only(c[0]):
IDBKeyRange.only(c);return b},nullDataHandler:function(){console.log("IndexedDB Query Succeeded!!!")},errorHandler:function(a){console.log("IndexedDB Database Error: "+a.target.errorCode);return!1}};return e}(OCRUISE||{});OCRUISE=function(e){e.cruiseList=function(a){var c=e.defaultValues.cruiseParms,b=this;this.editCruisePage=a;this.cruises=ko.observableArray([]);this.selectedCruise=ko.observable(new e.cruise(0,c));this.deleteCruise=function(a){if(confirm("Delete cruise?")){var c={cruiseid:a.cruiseID};e.DB.deleteRows([["cruise",c],["plots",c],["trees",c]],function(){b.logMessage("Cruise deleted.")});b.cruises.remove(a)}};this.editCruise=function(a){b.selectedCruise(a);$.mobile.pageContainer.pagecontainer("change",
b.editCruisePage,{})}};e.cruiseList.prototype={getCruises:function(){var a=this;e.DB.select("cruise","*","",function(c,b){a.updateListPageDOM(c,b)})},newCruise:function(a,c){var b=e.defaultValues.cruiseParms;e.DB.insert([["cruise","cname cpeople cdate cbaf field2name field3name field4name".split(" "),[b.jobName,b.cruisers,b.date,b.BAF,b.field2.name,b.field3.name,b.field4.name]]],function(c,g){var f=new e.cruise(g.insertId,b);a.cruises.push(f);a.editCruise(f)},function(){a.logMessage("Cruise created.")})},
deleteDatabase:function(){e.DB.deleteDatabase()},updateListPageDOM:function(a,c){var b,d,g;for(b=0;b<c.rows.length;b++)d=c.rows.item(b),g={jobName:d.cname,date:d.cdate,cruisers:d.cpeople,BAF:d.cbaf,mpm:d.mpm,field2:{name:d.field2name,min:d.field2min,max:d.field2max,init:d.field2init},field3:{name:d.field3name,min:d.field3min,max:d.field3max,init:d.field3init,field2Min:d.field3field2min},field4:{name:d.field4name,min:d.field4min,max:d.field4max,init:d.field4init}},this.cruises.push(new e.cruise(d.cruiseid,
g))},logMessage:function(a){console.log(a)}};return e}(OCRUISE||{});OCRUISE=function(e){e.cruise=function(a,c){var b=e.defaultValues;this.self=this;this.cruiseName=ko.observable(c.jobName);this.people=ko.observable(c.cruisers);this.BAF=ko.observable(c.BAF);this.date=ko.observable(c.date);this.multiProducts=ko.observable(Boolean(c.mpm));this.field2={name:ko.observable(c.field2.name||b.cruiseParms.field2.name),min:ko.observable(c.field2.min||b.cruiseParms.field2.min),max:ko.observable(c.field2.max||b.cruiseParms.field2.max),init:ko.observable(c.field2.init||b.cruiseParms.field2.init)};
this.field3={name:ko.observable(c.field3.name||b.cruiseParms.field3.name),min:ko.observable(c.field3.min||b.cruiseParms.field3.min),max:ko.observable(c.field3.max||b.cruiseParms.field3.max),init:ko.observable(c.field3.init||b.cruiseParms.field3.init),field2Min:ko.observable(c.field3.field2Min||b.cruiseParms.field3.field2Min)};this.field4={name:ko.observable(c.field4.name||b.cruiseParms.field4.name),min:ko.observable(c.field4.min||b.cruiseParms.field4.min),max:ko.observable(c.field4.max||b.cruiseParms.field4.max),
init:ko.observable(c.field4.init||b.cruiseParms.field4.init)};this.selectedPlot=ko.observable();this.plots=ko.observableArray([]);this.cruiseID=a;this.defaultSpecies=b.defaultSpecies;this.loadPlots();this.field1Values=ko.observableArray(b.speciesKey.toArray());this.showDownloadFileBtn=ko.observable(!1)};e.cruise.prototype={newPlot:function(a,c){$.mobile.loading("show",{text:"Loading",textVisible:!0,theme:"a",html:""});var b=this;e.DB.select("trees","plotnum","",function(a,c){var f=1,h;for(h=0;h<c.rows.length;h++)f=
c.rows.item(h),f=f.MAXPLOT+1,b.selectedPlot(new e.plot("new",b.cruiseID,f,b.defaultSpecies(),b.field2.name(),b.field3.name(),b.field4.name())),$.mobile.pageContainer.pagecontainer("change","#plotPage",{})},"MAXPLOT",{cruiseid:b.cruiseID})},updateCruise:function(a,c){var b={cname:this.cruiseName(),cpeople:this.people(),cdate:this.date(),cbaf:this.BAF(),mpm:Number(this.multiProducts()),field2name:this.field2.name(),field2min:this.field2.min(),field2max:this.field2.max(),field2init:this.field2.init(),
field3name:this.field3.name(),field3min:this.field3.min(),field3max:this.field3.max(),field3init:this.field3.init(),field3field2min:this.field3.field2Min(),field4name:this.field4.name(),field4min:this.field4.min(),field4max:this.field4.max(),field4init:this.field4.init()};e.DB.update("cruise",b,{cruiseid:this.cruiseID})},loadPlots:function(){var a=this;e.DB.select("plots","*","plotnum",function(c,b){var d,e;for(e=0;e<b.rows.length;e++)d=b.rows.item(e),a.plots.push({plotNum:d.plotnum,plotID:d.plotid})},
"",{cruiseid:a.cruiseID})},editPlot:function(a){$.mobile.loading("show",{text:"Loading",textVisible:!0,theme:"a",html:""});this.selectedPlot(new e.plot("edit",this.cruiseID,a,this.defaultSpecies(),this.field2.name(),this.field3.name(),this.field4.name()))},exportToCSV:function(){var a="",c="",b="",d=this,g={cruiseid:d.cruiseID},f=function(c,b){a=d.buildCSV(c,b);e.DB.select("cruise","*","",h,"",g)},h=function(f,g){var h=e.defaultValues;b=d.buildCSV(f,g);var h=h.field2.dbName+","+h.field3.dbName+","+
h.field4.dbName,n=d.field2.name()+","+d.field3.name()+","+d.field4.name();c=c.replace(h,n);d.csv="sep=,\r\n"+b+a+c;d.setFileDownload()};e.DB.select("trees","*","plotnum",function(a,b){c=d.buildCSV(a,b);e.DB.select("plots","*","plotnum",f,"",g)},"",g)},setFileDownload:function(){var a=!1,c;window.URL=window.URL||window.webkitURL;if(window.URL&&window.Blob){try{c=new Blob([this.csv],{type:"text/csv"})}catch(b){console.log("setFileDownload: blobs not supported")}window.URL.createObjectURL&&c?(a=window.URL.createObjectURL(c),
$("#downloadFileBtn").attr("href",a),$("#downloadFileBtn").attr("download",this.cruiseName()+".csv"),this.showDownloadFileBtn(!0),a=!0,console.log("File download supported!")):console.log("File download NOT supported.")}return a},buildCSV:function(a,c){var b="",d,e,f;if(0<c.rows.length){d=c.rows.item(c.rows.length-1);for(e in d)b+=e+",";b=b.substring(0,b.length-1);b+="\r\n"}for(e=0;e<c.rows.length;e++){d=c.rows.item(e);for(f in d)b+=d[f]+",";b=b.substring(0,b.length-1);b+="\r\n"}return b=b.replace(/null/g,
"")},sendEmail:function(){(function(a){return/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(a)})($("#emailTo").val())?($.mobile.loading("show",{text:"Connecting to server....",textVisible:!0,theme:"b",html:""}),$.ajax({type:"POST",url:"gmail.php",data:{data:this.csv,emailTo:$("#emailTo").val(),emailPW:$("#emailPW").val(),cruiseName:this.cruiseName},success:function(a){$.mobile.loading("hide");$("#emailSentPopup p").html("Results: "+a);$("#emailSentPopup").popup("open")},error:function(a,c,b){$.mobile.loading("hide");
$("#emailSentPopup p").html("Error: "+c+" - Make sure you have a network connection.");$("#emailSentPopup").popup("open")},dataType:"text"})):(alert("Invalid email address"),$.mobile.loading("hide"))}};return e}(OCRUISE||{});OCRUISE=function(e){e.plot=function(a,c,b,d,g,f,h){this.field1Name=e.defaultValues.field1.name;this.field2Name=g;this.field3Name=f;this.field4Name=h;this.plotnum=b;this.trees=ko.observableArray([]);this.plotID=ko.observable(b.toString());this.cruiseid=c;this.defaultSpecies=d;this.lastEditedTree=0;this.selectedTree=ko.observable();this.showSaveButton=ko.observable(!0);this.showUpdateButton=ko.observable(!1);this.showSpeechButton=ko.observable(!1);this.position={coords:{accuracy:null,latitude:null,
longitude:null}};if(window.SpeechRecognition){var l=this;this.recognition=new SpeechRecognition;this.recognition.continuous=!0;this.recognition.ocRunning=!1;this.recognition.ocSpeciesGrammar=this.buildSpeciesGrammar(e.defaultValues.speciesKey.species());this.recognition.onresult=function(a){l.speechInputResult(a)};this.recognition.onstart=function(){l.trees()[l.lastEditedTree].field1Focus(!0)};this.recognition.onend=function(){l.recognition.ocRunning&&l.recognition.start()};this.showSpeechButton(!0)}"new"==
a?this.initPlot():this.loadPlot()};e.plot.prototype={initPlot:function(){var a;for(a=0;10>a;a++)this.trees.push(new e.tree(this.defaultSpecies,null,null,null,[]));this.updatePosition();this.showSaveButton(!0);this.showUpdateButton(!1)},addTree:function(){this.trees.push(new e.tree(this.defaultSpecies,null,null,null,[]));$("#plotDetail").trigger("create")},loadPlot:function(){var a=this,c=e.defaultValues;this.showSaveButton(!1);this.showUpdateButton(!0);var b={cruiseid:this.cruiseid,plotnum:this.plotnum},
d=function(b,d){var h,l,k,m;for(h=0;h<d.rows.length;h++){k=d.rows.item(h);m=[];for(l=0;6>l;l++)m.push({product:k["seg"+l+"prod"],length:k["seg"+l+"len"]});a.trees.push(new e.tree(k[c.field1.dbName],k[c.field2.dbName],k[c.field3.dbName],k[c.field4.dbName],m));a.lastEditedTree++}k&&a.plotID(k.plotid);$.mobile.pageContainer.pagecontainer("change",c.pages.plotPage,{})};e.DB.select("plots","*","",function(c,f){a.position={coords:{accuracy:null,latitude:null,longitude:null}};if(0<f.rows.length){var h=f.rows.item(0);
a.plotID(h.plotid);a.position={coords:{accuracy:h.accuracy,latitude:h.latitude,longitude:h.longitude}}}e.DB.select("trees","*","",d,"",b)},"",b)},updatePosition:function(){var a=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(c){a.position=c},function(a){console.log("plot.updatePosition - unable to get current position.")},{timeout:5E4,maximumAge:0,enableHighAccuracy:!0})},speechInputToggle:function(a,c){var b=c.target;this.recognition.ocRunning?(this.recognition.ocRunning=
!1,$(b).css("background-color","#088A08"),this.recognition.stop(b)):(this.recognition.ocRunning=!0,this.recognition.start(b),$(b).css("background-color","#FF0000"))},speechInputResult:function(a){if(this.recognition.ocRunning){var c=e.defaultValues,b=this.trees(),d=$(":focus").attr("id"),g=parseInt(d.substr(4,d.indexOf("field")-4),10),d=d.substr(d.indexOf("field"));if((a=a.results[a.resultIndex][0].transcript.replace(/porn/gi,"4").replace(/for/gi,"4").replace(/to/gi,"2").replace(/att/gi,"8").replace(/ate/gi,
"8").replace(/sex/gi,"6"))&&d)switch(d){case "field1":a=this.getDistanceFromArray(a.toLowerCase(),this.recognition.ocSpeciesGrammar,10);if(c=c.speciesKey.getKey(a))b[g].field1(c),b[g].field2Focus(!0);break;case "field2":b[g].field2(a.replace(/\s+/g,""));b[g].field3Focus(!0);break;case "field3":b[g].field3(a.replace(/\s+/g,""));b[g].field4Focus(!0);break;case "field4":b[g].field4(a.replace(/\s+/g,"")),this.lastEditedTree++,b[g+1].field1Focus(!0)}$("#plotDetail select").selectmenu("refresh")}},buildSpeciesGrammar:function(a){var c,
b,d=[];for(c=0;c<a.length;c++)for(b=0;b<a[c].names.length;b++)d.push(a[c].names[b]);return d},getDistanceFromArray:function(a,c,b){for(var d=[],e=c.length;e--;)d[e]=this.levenshteinDistance(c[e],a);a=Math.min.apply(Math,d);return a<=b?c[d.indexOf(a)]:null},levenshteinDistance:function(a,c){var b=[],d=a.length,e=c.length;if(0===d)return e;if(0===e)return d;for(var f=d;0<=f;f--)b[f]=[];for(f=d;0<=f;f--)b[f][0]=f;for(var h=e;0<=h;h--)b[0][h]=h;for(f=1;f<=d;f++)for(var l=a.charAt(f-1),h=1;h<=e;h++){if(f===
h&&4<b[f][h])return d;var k=c.charAt(h-1),m=l===k?0:1,n=b[f-1][h]+1,p=b[f][h-1]+1,q=b[f-1][h-1]+m;p<n&&(n=p);q<n&&(n=q);b[f][h]=n;1<f&&1<h&&l===c.charAt(h-2)&&a.charAt(f-2)===k&&(b[f][h]=Math.min(b[f][h],b[f-2][h-2]+m))}return b[d][e]},insertPlot:function(a){this.recognition&&(this.recognition.ocRunning=!1);var c=e.defaultValues,b=this,d=this.trees(),g=[],f=this.position,h="cruiseid plotid plotnum comments covertype accuracy latitude longitude deleted".split(" ");g.push(["plots",h,[this.cruiseid,
this.plotID(),this.plotnum,"","",f.coords.accuracy,f.coords.latitude,f.coords.longitude,0]]);f="trees";h=["cruiseid","plotid","plotnum","treenum",c.field1.dbName,c.field2.dbName,c.field3.dbName,c.field4.dbName,"deleted","seg0prod","seg0len","seg1prod","seg1len","seg2prod","seg2len","seg3prod","seg3len","seg4prod","seg4len","seg5prod","seg5len"];for(c=0;c<d.length;c++)0<d[c].field2()&&g.push([f,h,[this.cruiseid,this.plotID(),this.plotnum,c,d[c].field1(),d[c].field2(),d[c].field3(),d[c].field4(),0,
d[c].segments[0].product(),d[c].segments[0].length(),d[c].segments[1].product(),d[c].segments[1].length(),d[c].segments[2].product(),d[c].segments[2].length(),d[c].segments[3].product(),d[c].segments[3].length(),d[c].segments[4].product(),d[c].segments[4].length(),d[c].segments[5].product(),d[c].segments[5].length()]]);e.DB.insert(g,function(){return!0},function(){a&&(a.plots.push({plotNum:b.plotnum,plotID:b.plotID()}),b.logMessage("Plot added."));$.mobile.pageContainer.pagecontainer("change","#cruisePage",
{})})},updatePlot:function(a){var c=this,b={cruiseid:this.cruiseid,plotnum:this.plotnum};e.DB.deleteRows([["plots",b],["trees",b]],function(){a.plots.remove(function(a){return a.plotNum==c.plotnum})});this.insertPlot(a)},multiProductEntry:function(a,c){this.selectedTree(a);$.mobile.pageContainer.pagecontainer("change","#multiProductPage",{})},logMessage:function(a){console.log(a)}};return e}(OCRUISE||{});OCRUISE=function(e){e.tree=function(a,c,b,d,g){var f=e.defaultValues,h=f.speciesKey.toArray();-1==h.indexOf(a)&&h.push(a);this.field1=ko.observable(a);this.field2=ko.observable(c);this.field3=ko.observable(b);this.field4=ko.observable(d);this.field1Focus=ko.observable(!1);this.field2Focus=ko.observable(!1);this.field3Focus=ko.observable(!1);this.field4Focus=ko.observable(!1);this.segments=[];this.grades=ko.observableArray(f.gradeKey.toArray());this.field1Values=ko.observableArray(h);for(a=0;6>a;a++)g[a]?
(this.segments.push({id:a,product:ko.observable(g[a].product),length:ko.observable(g[a].length)}),-1==this.grades.indexOf(g[a].product)&&this.grades.push(g[a].product)):this.segments.push({id:a,product:ko.observable(" "),length:ko.observable(null)})};e.tree.prototype={validateTree:function(a,c){var b=e.activeList.selectedCruise(),d=c.target,g=Number(d.value);-1<d.id.indexOf("field2")&&(g<b.field2.min()||g>b.field2.max())?$(d).parent().css("background-color","#FF0000"):-1<d.id.indexOf("field3")&&0<
g&&Number(a.field2())<b.field3.field2Min()?$(d).parent().css("background-color","#FF0000"):-1<d.id.indexOf("field3")&&(g<b.field3.min()||g>b.field3.max())?$(d).parent().css("background-color","#FF0000"):-1<d.id.indexOf("field4")&&(g<b.field4.min()||g>b.field4.max())?$(d).parent().css("background-color","#FF0000"):$(d).parent().css("background-color","#088A08")}};return e}(OCRUISE||{});OCRUISE=function(e){e.config=function(){this.cruiseParms={jobName:"New Cruise",cruisers:"Michigan Tech FERM",date:e.currentDate(),BAF:"10",mpm:!1,field2:{name:"DBH",min:"5",max:"62",init:""},field3:{name:"Saw",min:"0",max:"10",init:"",field2Min:11},field4:{name:"Pulp",min:"0",max:"12",init:""}};this.speciesKey={species:ko.observableArray([{key:"HM",names:["hard maple","sugar maple"]},{key:"RM",names:["red maple","soft maple"]},{key:"AS",names:["aspen"]},{key:"RO",names:["red oak"]},{key:"BF",names:["balsam fir"]},
{key:"YB",names:["yellow birch"]},{key:"PB",names:["paper birch","white birch"]},{key:"BW",names:["basswood"]},{key:"WA",names:["white ash"]},{key:"BA",names:["black ash"]},{key:"BC",names:["black cherry"]},{key:"BP",names:["balsam poplar"]},{key:"WP",names:["white pine"]},{key:"RP",names:["red pine"]},{key:"JP",names:["jack pine"]},{key:"WS",names:["white spruce"]},{key:"BS",names:["black spruce"]},{key:"TM",names:["tamarack"]},{key:"WC",names:["white cedar","cedar"]},{key:"EH",names:["hemlock"]},
{key:"AE",names:["elm"]},{key:"IW",names:["ironwood"]},{key:"MA",names:["mountain ash"]},{key:"SNAG",names:["snag"]}])};this.defaultSpecies=ko.observable("HM");this.field1={name:"Species",dbName:"species"};this.field2={dbName:"dbh"};this.field3={dbName:"sawlogs"};this.field4={dbName:"pulpsticks"};this.gradeKey={grades:ko.observableArray([{key:"1"},{key:"2"},{key:"3"},{key:"Bolt"},{key:"V"},{key:"C"},{key:"Pulp"}])};this.BAF=[10,20,40,80];this.pages={cruiseListPage:"#cruiseListPage",cruisePage:"#cruisePage",
plotPage:"#plotPage"};this.speciesKey.deleteSpecies=function(a,c){this.species.remove(a)};this.speciesKey.addSpecies=function(a,c){this.species.unshift({key:"new",names:[]});$("#configPage").trigger("create")};this.speciesKey.getKey=function(a){for(var c=0;c<this.species().length;c++)for(var b=0;b<this.species()[c].names.length;b++)if(this.species()[c].names[b]==a)return this.species()[c].key;return null};this.speciesKey.toArray=function(){for(var a=[],c=0;c<this.species().length;c++)a.push(this.species()[c].key);
return a};this.gradeKey.toArray=function(){for(var a=[],c=0;c<this.grades().length;c++)a.push(this.grades()[c].key);return a};this.gradeKey.deleteGrade=function(a,c){this.grades.remove(a)};this.gradeKey.addGrade=function(a,c){this.grades.unshift({key:"new"});$("#configPage").trigger("create")};this.save=function(a,c){a&&(a.max&&(a.max=parseInt(a.max,10)),a.min&&(a.min=parseInt(a.min,10)));localStorage.defaults=ko.toJSON(this)};this.load=function(){var a=JSON.parse(localStorage.defaults);this.speciesKey.species(a.speciesKey.species);
a.cruiseParms.hasOwnProperty("mpm")&&(this.cruiseParms=a.cruiseParms);a.gradeKey&&this.gradeKey.grades(a.gradeKey.grades);this.defaultSpecies(a.defaultSpecies)}};e.webSQLConfig=function(){var a=e.defaultValues;return{name:"CRUISEDB",version:"5.0",descript:"CRUISE DB",maxsize:2E5,tables:[{tableName:"cruise",fields:[{name:"cruiseid",type:"INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT"},{name:"cname",type:"TEXT NOT NULL"},{name:"cpeople",type:"TEXT NOT NULL"},{name:"cdate",type:"TEXT"},{name:"cbaf",type:"TEXT"},
{name:"mpm",type:"INTEGER"},{name:"field2name",type:'TEXT DEFAULT "DBH"'},{name:"field3name",type:'TEXT DEFAULT "Saw"'},{name:"field4name",type:'TEXT DEFAULT "Pulp"'},{name:"field2min",type:"TEXT"},{name:"field2max",type:"TEXT"},{name:"field2init",type:"TEXT"},{name:"field3min",type:"TEXT"},{name:"field3max",type:"TEXT"},{name:"field3init",type:"TEXT"},{name:"field3field2min",type:"TEXT"},{name:"field4min",type:"TEXT"},{name:"field4max",type:"TEXT"},{name:"field4init",type:"TEXT"}]},{tableName:"plots",
index:{name:"cruiseid_idx",fields:"cruiseid"},fields:[{name:"id",type:"INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT"},{name:"cruiseid",type:"INTEGER NOT NULL"},{name:"plotnum",type:"INTEGER NOT NULL"},{name:"plotid",type:"TEXT NOT NULL"},{name:"comments",type:"TEXT"},{name:"covertype",type:"TEXT"},{name:"accuracy",type:"INTEGER"},{name:"latitude",type:"REAL"},{name:"longitude",type:"REAL"},{name:"deleted",type:"INTEGER"}]},{tableName:"trees",index:{name:"cruiseid_plotnum_idx",fields:"cruiseid, plotnum"},
fields:[{name:"treeid",type:"INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT"},{name:"cruiseid",type:"INTEGER NOT NULL"},{name:"plotnum",type:"INTEGER NOT NULL"},{name:"plotid",type:"TEXT NOT NULL"},{name:"treenum",type:"INTEGER"},{name:a.field1.dbName,type:"TEXT NOT NULL"},{name:a.field2.dbName,type:"INTEGER NOT NULL"},{name:a.field3.dbName,type:"INTEGER"},{name:a.field4.dbName,type:"INTEGER"},{name:"deleted",type:"INTEGER"},{name:"seg0prod",type:"TEXT"},{name:"seg0len",type:"INTEGER"},{name:"seg1prod",
type:"TEXT"},{name:"seg1len",type:"INTEGER"},{name:"seg2prod",type:"TEXT"},{name:"seg2len",type:"INTEGER"},{name:"seg3prod",type:"TEXT"},{name:"seg3len",type:"INTEGER"},{name:"seg4prod",type:"TEXT"},{name:"seg4len",type:"INTEGER"},{name:"seg5prod",type:"TEXT"},{name:"seg5len",type:"INTEGER"}]}]}};e.indexedDBConfig=function(){return{name:"CRUISEDB",version:2,stores:[{storeName:"cruise",keyPath:"cruiseid",autoIncrement:!0,indexes:[{name:"cruiseid",fields:"cruiseid",unique:!0}]},{storeName:"plots",keyPath:["cruiseid",
"plotnum"],autoIncrement:!1,indexes:[{name:"cruiseid",fields:"cruiseid",unique:!1},{name:"cruiseidplotnum",fields:["cruiseid","plotnum"],unique:!0}]},{storeName:"trees",keyPath:["cruiseid","plotnum","treenum"],autoIncrement:!1,indexes:[{name:"cruiseid",fields:"cruiseid",unique:!1},{name:"cruiseidplotnum",fields:["cruiseid","plotnum"],unique:!1}]}]}};return e}(OCRUISE||{});